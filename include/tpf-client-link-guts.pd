#N canvas 0 106 406 243 10;
#N canvas 277 523 1094 427 gui.code 0;
#X obj 744 19 r \$3.reset;
#X obj 811 18 r \$3.peer.ready;
#X obj 811 38 sel 0;
#X obj 744 60 s \$3.display.reset;
#X obj 196 249 s \$3.glitch.label;
#X obj 227 269 s \$3.ooo.label;
#X obj 201 160 r \$3.display.reset;
#X msg 201 180 label empty;
#X obj 334 18 r \$3.jacktrip.stats;
#X obj 334 38 route dropped_count;
#X obj 334 60 makefilename %4d;
#X msg 334 80 label \$1;
#X obj 334 100 s \$3.dropped.label;
#X obj 173 228 s \$3.dropped.label;
#X msg 514 178 0;
#X obj 464 18 r \$3.jacktrip.stats;
#X obj 464 60 makefilename %4d;
#X msg 464 80 label \$1;
#X obj 594 18 r \$3.jacktrip.stats;
#X obj 594 60 makefilename %4d;
#X msg 594 80 label \$1;
#X obj 464 38 route glitch_count;
#X obj 464 100 s \$3.glitch.label;
#X obj 594 38 route ooo_count;
#X obj 594 100 s \$3.ooo.label;
#X obj 591 210 r \$3.from.jacktrip;
#X obj 591 230 route STATISTICS;
#X obj 591 250 s \$3.jacktrip.stats;
#X obj 360 183 r \$3.from.jacktrip;
#X obj 360 203 route STATUS;
#X obj 360 223 route inchannels;
#X obj 360 243 makefilename %4d;
#X msg 360 263 label \$1;
#X obj 360 283 s \$3.channels.label;
#X obj 240 289 s \$3.channels.label;
#N canvas 653 155 946 796 tx.button 0;
#X obj 47 429 s \$3.tx.switch.r;
#X msg 47 400 color \$1 \$2 \$3;
#X msg 47 348 0 0 0;
#X text 599 47 0 = reset;
#X obj 183 189 sel 1;
#X msg 183 210 1;
#X msg 212 210 0;
#X obj 158 278 spigot;
#X obj 158 163 r \$3.blink.clock;
#X obj 158 299 sel 0 1;
#X msg 322 210 0;
#X obj 268 278 spigot;
#X obj 268 163 r \$3.blink.clock;
#X obj 268 299 sel 0 1;
#X msg 293 210 1;
#X obj 293 189 sel 2;
#X text 600 125 4 = aborted;
#X obj 47 60 r \$3.aoo.link.status;
#X obj 242 41 r \$3.display.reset;
#X text 599 67 1 = waiting for peer (stun);
#X text 599 87 2 = waiting for user (stun);
#X text 601 108 3 = connected (stun);
#X text 600 146 5 = waiting for peer (server);
#X text 601 165 6 = waiting for user (server);
#X text 601 186 7 = connected (server);
#X obj 47 88 t a a a a a;
#X obj 47 136 select 0 3 4 7;
#X msg 226 354 224 224 224;
#X msg 95 350 128 0 255;
#X msg 308 356 0 0 255;
#X msg 442 210 0;
#X obj 388 278 spigot;
#X obj 388 163 r \$3.blink.clock;
#X obj 388 299 sel 0 1;
#X msg 413 210 1;
#X msg 545 210 0;
#X obj 491 278 spigot;
#X obj 491 163 r \$3.blink.clock;
#X obj 491 299 sel 0 1;
#X msg 516 210 1;
#X obj 413 189 sel 5;
#X obj 516 189 sel 6;
#X msg 155 350 0 255 0;
#X msg 367 356 255 255 0;
#X obj 603 363 r \$3.tx.switch.s;
#X obj 631 386 r \$3.aoo.link.status;
#X obj 603 386 f;
#X obj 603 409 sel 0;
#X obj 603 597 del 300;
#X msg 641 572 stop;
#X obj 603 482 f;
#X obj 688 488 + 1;
#X obj 603 504 t a a;
#X obj 603 528 sel 0 1;
#X obj 622 550 t b b b;
#X msg 707 525 0;
#X obj 603 618 t b b;
#X obj 672 620 s \$3.initiate.stun;
#X obj 603 700 s \$3.initiate.server;
#X obj 603 435 f;
#X obj 603 457 sel 1;
#X obj 176 235 t a a;
#X obj 413 231 t a a;
#X obj 631 652 r \$3.aoo.link.status;
#X obj 603 652 f;
#X obj 603 675 sel 0;
#X obj 630 435 r \$3.peer.state;
#X connect 1 0 0 0;
#X connect 2 0 1 0;
#X connect 4 0 5 0;
#X connect 4 1 6 0;
#X connect 5 0 61 0;
#X connect 6 0 7 1;
#X connect 7 0 9 0;
#X connect 8 0 7 0;
#X connect 9 0 2 0;
#X connect 9 1 28 0;
#X connect 10 0 11 1;
#X connect 11 0 13 0;
#X connect 12 0 11 0;
#X connect 13 0 2 0;
#X connect 13 1 42 0;
#X connect 14 0 11 1;
#X connect 15 0 14 0;
#X connect 15 1 10 0;
#X connect 17 0 25 0;
#X connect 18 0 2 0;
#X connect 25 0 26 0;
#X connect 25 1 4 0;
#X connect 25 2 15 0;
#X connect 25 3 40 0;
#X connect 25 4 41 0;
#X connect 26 0 2 0;
#X connect 26 1 28 0;
#X connect 26 2 27 0;
#X connect 26 3 29 0;
#X connect 27 0 1 0;
#X connect 28 0 1 0;
#X connect 29 0 1 0;
#X connect 30 0 31 1;
#X connect 31 0 33 0;
#X connect 32 0 31 0;
#X connect 33 0 2 0;
#X connect 33 1 29 0;
#X connect 34 0 62 0;
#X connect 35 0 36 1;
#X connect 36 0 38 0;
#X connect 37 0 36 0;
#X connect 38 0 2 0;
#X connect 38 1 43 0;
#X connect 39 0 36 1;
#X connect 40 0 34 0;
#X connect 40 1 30 0;
#X connect 41 0 39 0;
#X connect 41 1 35 0;
#X connect 42 0 1 0;
#X connect 43 0 1 0;
#X connect 44 0 46 0;
#X connect 45 0 46 1;
#X connect 46 0 47 0;
#X connect 47 0 59 0;
#X connect 48 0 56 0;
#X connect 49 0 48 0;
#X connect 50 0 52 0;
#X connect 51 0 50 1;
#X connect 52 0 53 0;
#X connect 52 1 51 0;
#X connect 53 0 48 0;
#X connect 53 0 29 0;
#X connect 53 1 54 0;
#X connect 54 0 57 0;
#X connect 54 1 49 0;
#X connect 54 2 55 0;
#X connect 55 0 50 1;
#X connect 56 0 64 0;
#X connect 56 1 55 0;
#X connect 59 0 60 0;
#X connect 60 0 50 0;
#X connect 61 0 7 0;
#X connect 61 1 7 1;
#X connect 62 0 31 0;
#X connect 62 1 31 1;
#X connect 63 0 64 1;
#X connect 64 0 65 0;
#X connect 65 0 58 0;
#X connect 66 0 59 1;
#X restore 15 73 pd tx.button;
#X obj 805 138 metro 500;
#X obj 805 159 == 0;
#X obj 805 180 t a a;
#X obj 805 110 loadbang;
#X obj 805 204 s \$3.blink.clock;
#X obj 514 127 r \$3.aoo.link.status;
#X obj 514 148 sel 3;
#X obj 446 334 r \$3.from.jacktrip;
#X obj 446 354 route STATUS;
#X obj 446 375 route receiving;
#N canvas 625 406 491 361 rx.button 0;
#X obj 16 14 r \$3.from.jacktrip;
#X obj 16 34 route STATUS;
#X obj 16 55 route receiving;
#X obj 16 76 sel 0 1;
#X obj 16 269 s \$3.rx.switch.r;
#X msg 16 246 color \$1 \$2 \$3;
#X obj 278 141 r \$3.display.reset;
#X msg 278 190 0 0 0;
#X obj 296 163 loadbang;
#X obj 31 103 r \$3.aoo.link.status;
#X obj 16 128 f;
#X obj 16 155 sel 0;
#X obj 86 140 sel 0;
#X msg 16 190 224 224 224;
#X obj 147 188 list append;
#X msg 167 108 128 0 255;
#X obj 167 55 r \$3.aoo.link.status;
#X obj 167 80 sel 3 7;
#X msg 239 112 0 0 255;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 3 0 10 0;
#X connect 3 1 14 0;
#X connect 5 0 4 0;
#X connect 6 0 7 0;
#X connect 7 0 5 0;
#X connect 8 0 7 0;
#X connect 9 0 10 1;
#X connect 9 0 12 0;
#X connect 10 0 11 0;
#X connect 11 1 13 0;
#X connect 12 0 7 0;
#X connect 13 0 5 0;
#X connect 14 0 5 0;
#X connect 15 0 14 1;
#X connect 16 0 17 0;
#X connect 17 0 15 0;
#X connect 17 1 18 0;
#X connect 18 0 14 1;
#X restore 15 99 pd rx.button;
#N canvas 347 761 450 300 delay.nb 0;
#X obj 45 170 s \$3.delay.nb.r;
#X msg 45 144 color -1 \$1 -1;
#X msg 45 72 -1;
#X msg 81 76 0;
#X obj 45 17 r \$3.peer.ready;
#X obj 45 38 sel 0 1;
#X obj 81 97 t a a;
#X obj 228 74 s \$3.delay;
#X obj 228 44 r \$3.delay.nb.s;
#X connect 1 0 0 0;
#X connect 2 0 1 0;
#X connect 3 0 6 0;
#X connect 4 0 5 0;
#X connect 5 0 2 0;
#X connect 5 1 3 0;
#X connect 6 0 1 0;
#X connect 6 1 0 0;
#X connect 8 0 7 0;
#X restore 14 124 pd delay.nb;
#N canvas 339 360 431 345 peer.name 0;
#X obj 11 74 s \$3.client.label;
#X msg 11 46 label \$1;
#X obj 11 22 r \$3.peer.name;
#X obj 12 207 s \$3.client.label;
#X msg 12 179 color -1 -1 \$1;
#X msg 12 153 1;
#X msg 51 155 0;
#X msg 127 41 label empty;
#X obj 12 104 r \$3.peer.state;
#X obj 12 128 sel 0 1 2;
#X connect 1 0 0 0;
#X connect 2 0 1 0;
#X connect 4 0 3 0;
#X connect 5 0 4 0;
#X connect 6 0 4 0;
#X connect 7 0 0 0;
#X connect 8 0 9 0;
#X connect 9 0 5 0;
#X connect 9 1 6 0;
#X connect 9 2 6 0;
#X restore 17 18 pd peer.name;
#N canvas 428 518 482 325 arrow.up.down 0;
#X obj 12 16 r \$3.arrow.up;
#X obj 12 39 sel 0;
#X obj 54 40 t a;
#X obj 250 289 s \$3.arrow.up.r;
#X msg 250 249 color -1 -1 \$1;
#X msg 250 221 12;
#X msg 281 220 1;
#X obj 223 32 r \$3.peer.name;
#X obj 223 55 select empty;
#X msg 223 78 0;
#X msg 292 78 1;
#X obj 223 147 &&;
#X obj 330 91 t b a;
#X obj 223 103 t a;
#X obj 250 195 sel 0 1;
#X obj 12 63 f \$2;
#X obj 12 86 - 1;
#X obj 100 238 s \$3.swap.request;
#X obj 100 40 sel 0;
#X obj 142 41 t a;
#X obj 100 64 f \$2;
#X obj 100 17 r \$3.arrow.down;
#X obj 100 87 + 1;
#X obj 352 289 s \$3.arrow.down.r;
#X obj 223 170 t a a;
#X obj 100 148 spigot;
#X obj 330 57 != 2;
#X obj 330 31 r \$3.peer.state;
#X connect 0 0 1 0;
#X connect 1 0 15 0;
#X connect 1 1 2 0;
#X connect 2 0 1 1;
#X connect 4 0 3 0;
#X connect 4 0 23 0;
#X connect 5 0 4 0;
#X connect 6 0 4 0;
#X connect 7 0 8 0;
#X connect 8 0 9 0;
#X connect 8 1 10 0;
#X connect 9 0 13 0;
#X connect 10 0 13 0;
#X connect 11 0 24 0;
#X connect 12 0 11 0;
#X connect 12 1 11 1;
#X connect 13 0 11 0;
#X connect 14 0 5 0;
#X connect 14 1 6 0;
#X connect 15 0 16 0;
#X connect 16 0 25 0;
#X connect 18 0 20 0;
#X connect 18 1 19 0;
#X connect 19 0 18 1;
#X connect 20 0 22 0;
#X connect 21 0 18 0;
#X connect 22 0 25 0;
#X connect 24 0 25 1;
#X connect 24 1 14 0;
#X connect 25 0 17 0;
#X connect 26 0 12 0;
#X connect 27 0 26 0;
#X restore 16 46 pd arrow.up.down;
#X connect 0 0 3 0;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 6 0 7 0;
#X connect 7 0 4 0;
#X connect 7 0 5 0;
#X connect 7 0 13 0;
#X connect 7 0 34 0;
#X connect 8 0 9 0;
#X connect 9 0 10 0;
#X connect 10 0 11 0;
#X connect 11 0 12 0;
#X connect 14 0 10 0;
#X connect 14 0 16 0;
#X connect 14 0 19 0;
#X connect 14 0 31 0;
#X connect 15 0 21 0;
#X connect 16 0 17 0;
#X connect 17 0 22 0;
#X connect 18 0 23 0;
#X connect 19 0 20 0;
#X connect 20 0 24 0;
#X connect 21 0 16 0;
#X connect 23 0 19 0;
#X connect 25 0 26 0;
#X connect 26 0 27 0;
#X connect 28 0 29 0;
#X connect 29 0 30 0;
#X connect 30 0 31 0;
#X connect 31 0 32 0;
#X connect 32 0 33 0;
#X connect 36 0 37 0;
#X connect 37 0 38 0;
#X connect 38 0 40 0;
#X connect 38 1 37 1;
#X connect 39 0 36 0;
#X connect 41 0 42 0;
#X connect 42 0 14 0;
#X connect 43 0 44 0;
#X connect 44 0 45 0;
#X restore 13 137 pd gui.code;
#N canvas 295 122 994 772 peer.assignment 0;
#X obj 8 50 loadbang;
#X msg 8 73 symbol empty;
#X text 7 15 === init peer ===;
#X obj 8 96 s \$3.peer.name;
#X obj 600 45 r \$3.swap.request;
#X obj 625 67 r \$3.peer.name;
#X obj 600 141 s \$1.intercom;
#X text 593 16 === swap peer link ===;
#X text 725 45 ----- REQUEST ---------;
#X obj 601 174 r \$1.intercom;
#X obj 601 197 route peer_swap_request;
#X obj 601 257 route \$2;
#X obj 601 220 spigot;
#X msg 670 326 \$2;
#X obj 716 325 r \$3.peer.name;
#X obj 670 395 s \$1.intercom;
#X text 715 174 ----- HANDLE REQUEST ---------;
#X text 713 305 ----- RESPONSE ---------;
#X obj 635 441 s \$3.peer.name;
#X text 715 507 ----- HANDLE RESPONSE ---------;
#X msg 635 418 symbol \$1;
#X obj 601 280 list;
#X obj 601 510 r \$1.intercom;
#X obj 601 533 route peer_swap_response;
#X obj 601 556 route \$2;
#X obj 633 654 s \$3.peer.name;
#X obj 46 365 r \$3.peer.name;
#X obj 13 392 symbol;
#X obj 13 339 route fetch_settings;
#X obj 13 362 b;
#X obj 13 415 list prepend \$2;
#X msg 13 440 save_settings peer_name \$1 \$2;
#X obj 12 518 route restore_settings;
#X obj 12 541 route peer_name;
#X obj 12 564 route \$2;
#X obj 12 587 symbol;
#X obj 12 610 s \$3.peer.name;
#X obj 13 316 r \$1.intercom;
#X obj 13 466 s \$1.intercom;
#X obj 12 495 r \$1.intercom;
#X obj 181 49 r \$1.intercom;
#X obj 181 72 route peer_reclaim;
#X obj 181 95 list;
#X msg 208 164 peer_reclaimed;
#X obj 208 187 s \$1.intercom;
#X obj 9 122 loadbang;
#X obj 9 168 s \$3.peer.state;
#X msg 9 145 0;
#X text 12 192 states:;
#X text 12 202 =======;
#X text 12 222 0: offline;
#X text 12 242 1: online;
#X text 12 262 0: streaming;
#X obj 219 118 r \$3.peer.name;
#X obj 181 118 sel -;
#X obj 181 232 s \$3.peer.state;
#X obj 181 141 t b b;
#X msg 181 208 1;
#X obj 346 48 r \$1.intercom;
#X obj 346 71 route peer_new;
#X obj 392 166 r \$3.peer.name;
#X obj 346 193 sel empty, f 23;
#X obj 346 115 list;
#X obj 373 240 symbol;
#X obj 346 216 t b b;
#X obj 373 263 s \$3.peer.name;
#X obj 346 310 s \$3.peer.state;
#X msg 346 286 1;
#X text 181 16 === reclaim ==========;
#X text 347 17 === grab ================;
#X obj 346 94 route \$2;
#X obj 346 138 t b a, f 12;
#X obj 346 167 symbol;
#X obj 481 221 b;
#X obj 481 248 symbol;
#X obj 481 271 t b a;
#X obj 481 294 f \$2;
#X obj 481 317 + 1;
#X obj 481 340 list append;
#X msg 481 363 peer_new \$1 \$2;
#X obj 481 386 s \$1.intercom;
#X text 218 427 === leave ==========;
#X obj 222 453 r \$1.intercom;
#X obj 222 476 route peer_leave;
#X obj 221 617 r \$1.intercom;
#X obj 221 640 route peer_leave_all;
#X obj 221 685 s \$3.peer.state;
#X msg 221 662 0;
#X obj 222 529 route -;
#X obj 261 503 r \$3.peer.name;
#X obj 222 575 s \$3.peer.state;
#X msg 222 552 0;
#X obj 600 95 pack f s \$2 f;
#X obj 690 93 r \$3.peer.state;
#X text 782 117 dst peername src state;
#X obj 669 221 r \$3.peer.state;
#X obj 669 244 != 2;
#X obj 807 325 r \$3.peer.state;
#X obj 670 349 pack f s f, f 16;
#X msg 670 372 peer_swap_response \$1 \$2 \$3;
#X text 842 373 dst peername state;
#X msg 601 441 \$3;
#X obj 601 464 s \$3.peer.state;
#X obj 601 579 list;
#X obj 601 602 t a a;
#X msg 633 632 symbol \$1;
#X msg 601 655 \$2;
#X obj 601 678 s \$3.peer.state;
#X msg 600 118 peer_swap_request \$1 \$2 \$3 \$4;
#X obj 601 303 t a a a, f 12;
#X obj 394 459 r \$3.client.reset;
#X obj 394 482 sel;
#X obj 423 483 t a;
#X obj 394 505 f;
#X obj 423 505 r \$3.peer.state;
#X obj 394 528 sel 0;
#X text 396 427 === reset ==========;
#X msg 393 659 symbol empty;
#X obj 393 682 s \$3.peer.name;
#X obj 394 576 del 300;
#X msg 394 610 0;
#X obj 394 551 t b b b;
#X msg 478 580 1;
#X obj 433 627 t a b;
#X obj 433 604 spigot 0;
#X connect 0 0 1 0;
#X connect 1 0 3 0;
#X connect 4 0 92 0;
#X connect 5 0 92 1;
#X connect 9 0 10 0;
#X connect 10 0 12 0;
#X connect 11 0 21 0;
#X connect 12 0 11 0;
#X connect 13 0 98 0;
#X connect 14 0 98 1;
#X connect 20 0 18 0;
#X connect 21 0 109 0;
#X connect 22 0 23 0;
#X connect 23 0 24 0;
#X connect 24 0 103 0;
#X connect 26 0 27 1;
#X connect 27 0 30 0;
#X connect 28 0 29 0;
#X connect 29 0 27 0;
#X connect 30 0 31 0;
#X connect 31 0 38 0;
#X connect 32 0 33 0;
#X connect 33 0 34 0;
#X connect 34 0 35 0;
#X connect 35 0 36 0;
#X connect 37 0 28 0;
#X connect 39 0 32 0;
#X connect 40 0 41 0;
#X connect 41 0 42 0;
#X connect 42 0 54 0;
#X connect 43 0 44 0;
#X connect 45 0 47 0;
#X connect 47 0 46 0;
#X connect 53 0 54 1;
#X connect 54 0 56 0;
#X connect 56 0 57 0;
#X connect 56 1 43 0;
#X connect 57 0 55 0;
#X connect 58 0 59 0;
#X connect 59 0 70 0;
#X connect 60 0 72 1;
#X connect 61 0 64 0;
#X connect 61 1 73 0;
#X connect 62 0 71 0;
#X connect 63 0 65 0;
#X connect 64 0 67 0;
#X connect 64 1 63 0;
#X connect 67 0 66 0;
#X connect 70 0 62 0;
#X connect 71 0 72 0;
#X connect 71 1 63 1;
#X connect 71 1 74 1;
#X connect 72 0 61 0;
#X connect 73 0 74 0;
#X connect 74 0 75 0;
#X connect 75 0 76 0;
#X connect 75 1 78 1;
#X connect 76 0 77 0;
#X connect 77 0 78 0;
#X connect 78 0 79 0;
#X connect 79 0 80 0;
#X connect 82 0 83 0;
#X connect 83 0 88 0;
#X connect 84 0 85 0;
#X connect 85 0 87 0;
#X connect 87 0 86 0;
#X connect 88 0 91 0;
#X connect 89 0 88 1;
#X connect 91 0 90 0;
#X connect 92 0 108 0;
#X connect 93 0 92 3;
#X connect 95 0 96 0;
#X connect 96 0 12 1;
#X connect 97 0 98 2;
#X connect 98 0 99 0;
#X connect 99 0 15 0;
#X connect 101 0 102 0;
#X connect 103 0 104 0;
#X connect 104 0 106 0;
#X connect 104 1 105 0;
#X connect 105 0 25 0;
#X connect 106 0 107 0;
#X connect 108 0 6 0;
#X connect 109 0 101 0;
#X connect 109 1 20 0;
#X connect 109 2 13 0;
#X connect 110 0 111 0;
#X connect 111 0 113 0;
#X connect 111 1 112 0;
#X connect 112 0 111 1;
#X connect 113 0 115 0;
#X connect 114 0 113 1;
#X connect 115 0 121 0;
#X connect 117 0 118 0;
#X connect 119 0 120 0;
#X connect 120 0 124 1;
#X connect 121 0 119 0;
#X connect 121 1 122 0;
#X connect 121 2 124 0;
#X connect 122 0 124 1;
#X connect 123 0 117 0;
#X connect 123 1 120 0;
#X connect 124 0 123 0;
#X restore 13 42 pd peer.assignment;
#N canvas 162 142 1571 751 aoo.start.stop 0;
#X obj 662 28 r \$3.from.jacktrip;
#X obj 662 48 route STATUS;
#X obj 160 153 r \$1.channels;
#X obj 247 153 r \$1.blocksize;
#X msg 797 437 queue \$1;
#X msg 25 444 start;
#X obj 25 70 r \$3.aoo.link.status;
#X obj 662 167 s \$3.aoo.link.status;
#X obj 662 114 sel 0;
#X msg 662 139 4;
#X obj 355 68 r \$3.tx.switch.s;
#X obj 383 91 r \$3.aoo.link.status;
#X obj 355 91 f;
#X obj 355 528 s \$3.aoo.link.status;
#X msg 355 506 0;
#X obj 355 148 t b b;
#X obj 681 88 tgl 20 0 empty empty empty 17 7 0 10 -204786 -1 -1 0
1;
#X obj 355 485 del 0;
#X obj 662 68 route connected;
#X obj 25 91 sel 3 7;
#X obj 355 114 sel 1 3 4 5 7;
#X obj 1331 459 t a a;
#X obj 1358 641 s \$1.info;
#X obj 1358 508 t a a;
#X obj 1373 577 list append;
#X obj 1476 484 change 0;
#X obj 1476 511 sel 0;
#X obj 1358 484 list append;
#X obj 1383 456 r \$3.peer.name;
#X obj 797 462 s \$3.to.jacktrip;
#X obj 833 17 r \$3.from.jacktrip;
#X obj 833 37 route STATUS;
#X obj 900 200 /;
#X obj 900 156 t a b;
#X obj 932 179 samplerate~;
#X obj 900 132 * 1000;
#X obj 818 235 t b a, f 6;
#X obj 797 283 expr ceil($f1);
#X obj 797 260 /;
#X obj 797 306 max 2;
#X obj 900 223 t a a;
#X obj 912 430 *;
#X obj 797 135 r \$1.recvbuf;
#X obj 961 220 r \$3.from.jacktrip;
#X obj 961 240 route STATUS;
#X obj 961 260 route connected;
#X obj 797 331 spigot 0;
#X obj 797 399 t a a a, f 18;
#X obj 915 82 t a a, f 10;
#X msg 1358 537 [\$4] connected localhost:\$3 => \$1:\$2;
#X msg 1373 602 [\$4] disconnected localhost:\$3 => \$1:\$2;
#X obj 918 504 list append;
#X obj 993 504 r \$3.peer.name;
#X obj 961 283 t a a;
#X obj 988 306 sel 0;
#X msg 988 329 set -1;
#X obj 797 364 change -1;
#X obj 918 568 s \$1.info;
#X obj 918 480 pack f f, f 20;
#X obj 1105 215 pack f f;
#X obj 1035 408 * 10;
#X obj 1035 431 int;
#X obj 1035 454 * 0.1;
#X text 1046 480 q recvbuf;
#X obj 1105 285 s \$1.info;
#X obj 833 57 route inchannels inblocksize;
#X text 1171 216 inchannels \, blocksize;
#X obj 1105 238 list append;
#X obj 1180 238 r \$3.peer.name;
#X msg 918 530 [\$3] setting queue=\$1 (receive buffer=\$2ms);
#X msg 1105 261 [\$3] receiving stream with \$1 channels and blocksize=\$2
;
#X obj 833 80 t b a;
#X obj 900 106 f;
#X obj 82 178 pack f f f, f 28;
#X obj 25 122 t b b, f 10;
#X obj 82 153 samplerate~;
#X msg 82 202 format pcm \$2 \$3 \$1 16;
#X obj 382 198 s \$0.to.peer;
#X obj 382 221 r \$0.from.peer;
#X obj 382 245 route stop;
#X obj 82 225 s \$3.to.aoo;
#X obj 392 472 s \$3.to.aoo;
#X obj 1478 449 r \$3.peer.id;
#X obj 110 287 r \$3.peer.name;
#X obj 110 313 r \$3.peer.id;
#X obj 25 313 list append;
#X obj 110 260 r \$1.room;
#X obj 25 286 list append;
#X obj 25 260 symbol;
#X obj 25 337 t a a;
#X obj 52 362 s \$0.destination;
#X obj 25 475 s \$3.to.aoo;
#X obj 25 414 t b a, f 15;
#X text 98 123 ==== set format ==================;
#X msg 25 391 add \$1 \$2 \$3;
#X obj 355 319 t b b b, f 13;
#X obj 455 296 r \$0.destination;
#X obj 392 368 list append;
#X msg 392 417 remove \$1 \$2 \$3;
#X obj 495 170 sel 0;
#X obj 495 148 r \$3.peer.state;
#X obj 523 194 r \$3.aoo.link.status;
#X obj 495 194 f;
#X obj 495 217 sel 3 7;
#X obj 495 241 t b;
#X text 26 29 ==== start streaming ============;
#X text 348 30 ==== stop streaming ============;
#X obj 455 319 t b a;
#X msg 455 343 1;
#X obj 392 346 spigot;
#X obj 392 391 t a b;
#X msg 480 385 0;
#X msg 430 448 stop;
#X msg 382 174 dest stop \, bang;
#X connect 0 0 1 0;
#X connect 1 0 18 0;
#X connect 2 0 73 1;
#X connect 3 0 73 2;
#X connect 4 0 29 0;
#X connect 5 0 91 0;
#X connect 6 0 19 0;
#X connect 8 0 9 0;
#X connect 9 0 7 0;
#X connect 10 0 12 0;
#X connect 11 0 12 1;
#X connect 12 0 20 0;
#X connect 14 0 13 0;
#X connect 15 0 95 0;
#X connect 15 1 113 0;
#X connect 17 0 14 0;
#X connect 18 0 8 0;
#X connect 18 0 16 0;
#X connect 18 0 25 0;
#X connect 19 0 74 0;
#X connect 19 1 74 0;
#X connect 20 0 15 0;
#X connect 20 1 15 0;
#X connect 20 2 15 0;
#X connect 20 3 15 0;
#X connect 20 4 15 0;
#X connect 21 1 27 0;
#X connect 23 0 49 0;
#X connect 23 1 24 1;
#X connect 24 0 50 0;
#X connect 25 0 26 0;
#X connect 26 0 24 0;
#X connect 27 0 23 0;
#X connect 28 0 27 1;
#X connect 30 0 31 0;
#X connect 31 0 65 0;
#X connect 32 0 40 0;
#X connect 33 0 32 0;
#X connect 33 1 34 0;
#X connect 34 0 32 1;
#X connect 35 0 33 0;
#X connect 36 0 38 0;
#X connect 36 1 38 1;
#X connect 37 0 39 0;
#X connect 38 0 37 0;
#X connect 39 0 46 0;
#X connect 40 0 36 0;
#X connect 40 1 41 1;
#X connect 41 0 60 0;
#X connect 42 0 38 0;
#X connect 43 0 44 0;
#X connect 44 0 45 0;
#X connect 45 0 53 0;
#X connect 46 0 56 0;
#X connect 47 0 4 0;
#X connect 47 1 58 0;
#X connect 47 2 41 0;
#X connect 48 0 72 1;
#X connect 48 1 59 1;
#X connect 49 0 22 0;
#X connect 50 0 22 0;
#X connect 51 0 69 0;
#X connect 52 0 51 1;
#X connect 53 0 46 1;
#X connect 53 1 54 0;
#X connect 54 0 55 0;
#X connect 55 0 56 0;
#X connect 56 0 47 0;
#X connect 58 0 51 0;
#X connect 59 0 67 0;
#X connect 60 0 61 0;
#X connect 61 0 62 0;
#X connect 62 0 58 1;
#X connect 65 0 71 0;
#X connect 65 1 48 0;
#X connect 67 0 70 0;
#X connect 68 0 67 1;
#X connect 69 0 57 0;
#X connect 70 0 64 0;
#X connect 71 0 72 0;
#X connect 71 1 59 0;
#X connect 72 0 35 0;
#X connect 73 0 76 0;
#X connect 74 0 88 0;
#X connect 74 1 75 0;
#X connect 75 0 73 0;
#X connect 76 0 80 0;
#X connect 78 0 79 0;
#X connect 79 0 95 0;
#X connect 83 0 87 1;
#X connect 84 0 85 1;
#X connect 85 0 89 0;
#X connect 86 0 88 1;
#X connect 87 0 85 0;
#X connect 88 0 87 0;
#X connect 89 0 94 0;
#X connect 89 1 90 0;
#X connect 92 0 5 0;
#X connect 92 1 91 0;
#X connect 94 0 92 0;
#X connect 95 0 17 0;
#X connect 95 1 109 0;
#X connect 95 2 112 0;
#X connect 96 0 107 0;
#X connect 97 0 110 0;
#X connect 98 0 81 0;
#X connect 99 0 102 0;
#X connect 100 0 99 0;
#X connect 101 0 102 1;
#X connect 102 0 103 0;
#X connect 103 0 104 0;
#X connect 103 1 104 0;
#X connect 104 0 95 0;
#X connect 107 0 108 0;
#X connect 107 1 97 1;
#X connect 108 0 109 1;
#X connect 109 0 97 0;
#X connect 110 0 98 0;
#X connect 110 1 111 0;
#X connect 111 0 109 1;
#X connect 112 0 81 0;
#X connect 113 0 77 0;
#X restore 13 113 pd aoo.start.stop;
#X obj 237 24 loadbang;
#X msg 237 79 0;
#X obj 237 102 s \$3.aoo.link.status;
#X obj 245 50 r \$3.reset;
#N canvas 189 473 513 313 peer.com 0;
#X obj 297 59 r \$1.origin;
#X obj 235 32 r \$1.oscrecv;
#X obj 19 216 s \$1.oscsend;
#X obj 19 49 route dest;
#X obj 88 66 r \$3.peer.name;
#X obj 19 119 list prepend;
#X obj 88 91 list append tpf link;
#X obj 19 142 list prepend dest;
#X obj 19 165 list trim;
#X obj 46 88 list;
#X obj 132 143 r \$3.peer.state;
#X obj 132 167 > 0;
#X obj 19 190 spigot;
#X msg 297 82 symbol \$2;
#X obj 297 139 select ---;
#X obj 354 108 r \$3.peer.name;
#X msg 297 162 1;
#X msg 354 164 0;
#X obj 235 193 spigot;
#X obj 235 216 route tpf;
#X obj 235 239 route link;
#X obj 19 26 r \$0.to.peer;
#X obj 235 262 s \$0.from.peer;
#X connect 0 0 13 0;
#X connect 1 0 18 0;
#X connect 3 0 5 0;
#X connect 3 1 9 0;
#X connect 4 0 6 0;
#X connect 5 0 7 0;
#X connect 6 0 5 1;
#X connect 7 0 8 0;
#X connect 8 0 12 0;
#X connect 9 0 12 0;
#X connect 10 0 11 0;
#X connect 11 0 12 1;
#X connect 12 0 2 0;
#X connect 13 0 14 0;
#X connect 14 0 16 0;
#X connect 14 1 17 0;
#X connect 15 0 14 1;
#X connect 16 0 18 1;
#X connect 17 0 18 1;
#X connect 18 0 19 0;
#X connect 19 0 20 0;
#X connect 20 0 22 0;
#X connect 21 0 3 0;
#X restore 13 19 pd peer.com;
#N canvas 0 426 926 378 init.p2p.connection 0;
#X obj 23 60 r \$3.initiate.server;
#X obj 23 182 s \$3.aoo.link.status;
#X obj 23 132 del 0;
#X msg 23 154 5;
#X obj 468 58 r \$3.tx.switch.s;
#X obj 493 81 r \$3.aoo.link.status;
#X obj 468 81 f;
#X obj 468 129 f;
#X obj 468 151 sel 1;
#X obj 468 172 t b b, f 11;
#X obj 468 275 s \$3.aoo.link.status;
#X obj 468 198 del 0;
#X obj 468 104 sel 6;
#X msg 468 252 7;
#X obj 760 169 r \$3.aoo.link.status;
#X obj 735 169 f;
#X obj 735 192 sel 5;
#X obj 735 213 f;
#X obj 735 257 s \$3.aoo.link.status;
#X msg 735 235 7;
#N canvas 58 279 755 431 deal.with.race.condition 0;
#X obj 52 85 r \$3.aoo.link.status;
#X obj 27 85 f;
#X obj 27 168 sel 0 4;
#X obj 27 193 f;
#X obj 27 215 sel 1;
#X obj 27 329 s \$3.aoo.link.status;
#X msg 27 308 6;
#X obj 27 18 inlet;
#X obj 223 155 f;
#X obj 223 177 sel 1;
#X obj 223 130 sel 5;
#X obj 223 225 s \$3.aoo.link.status;
#X msg 223 204 7;
#X text 354 17 When both clients initiatate a connection simultaneously
\, their requests cross each other and we want to establish a connecction
immediately without confirmation (before we dealt with that situation
\, both clients flashed blue happily waiting for confirmation).;
#X obj 250 155 r \$3.peer.state;
#X obj 54 193 r \$3.peer.state;
#X connect 0 0 1 1;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 2 1 3 0;
#X connect 2 2 10 0;
#X connect 3 0 4 0;
#X connect 4 0 6 0;
#X connect 6 0 5 0;
#X connect 7 0 1 0;
#X connect 8 0 9 0;
#X connect 9 0 12 0;
#X connect 10 0 8 0;
#X connect 10 1 8 0;
#X connect 12 0 11 0;
#X connect 14 0 8 1;
#X connect 15 0 3 1;
#X restore 258 172 pd deal.with.race.condition;
#X obj 92 153 s \$0.to.peer;
#X obj 23 81 t b b, f 12;
#X obj 92 106 f \$2, f 5;
#X msg 92 129 dest initiate p2p \, \$1;
#X obj 258 57 r \$0.from.peer;
#X obj 258 81 route initiate;
#X obj 258 101 route p2p;
#X obj 285 148 s \$3.peer.id;
#X obj 258 124 t b a;
#X obj 531 198 f \$2;
#X obj 531 246 s \$0.to.peer;
#X msg 531 224 dest confirm p2p \, \$1;
#X obj 735 58 r \$0.from.peer;
#X obj 735 82 route confirm;
#X obj 735 102 route p2p;
#X obj 762 148 s \$3.peer.id;
#X obj 735 124 t b a;
#X obj 762 213 r \$3.peer.state;
#X text 35 18 1) SEND INIT;
#X text 250 19 2) HANDLE INIT REQUEST;
#X text 465 20 3) CONFIRM;
#X text 732 20 4) HANDLE CONFIRMATION;
#X obj 495 129 r \$3.peer.state;
#X connect 0 0 22 0;
#X connect 2 0 3 0;
#X connect 3 0 1 0;
#X connect 4 0 6 0;
#X connect 5 0 6 1;
#X connect 6 0 12 0;
#X connect 7 0 8 0;
#X connect 8 0 9 0;
#X connect 9 0 11 0;
#X connect 9 1 30 0;
#X connect 11 0 13 0;
#X connect 12 0 7 0;
#X connect 13 0 10 0;
#X connect 14 0 15 1;
#X connect 15 0 16 0;
#X connect 16 0 17 0;
#X connect 17 0 19 0;
#X connect 19 0 18 0;
#X connect 22 0 2 0;
#X connect 22 1 23 0;
#X connect 23 0 24 0;
#X connect 24 0 21 0;
#X connect 25 0 26 0;
#X connect 26 0 27 0;
#X connect 27 0 29 0;
#X connect 29 0 20 0;
#X connect 29 1 28 0;
#X connect 30 0 32 0;
#X connect 32 0 31 0;
#X connect 33 0 34 0;
#X connect 34 0 35 0;
#X connect 35 0 37 0;
#X connect 37 0 15 0;
#X connect 37 1 36 0;
#X connect 38 0 17 1;
#X connect 43 0 7 1;
#X restore 13 89 pd init.p2p.connection;
#N canvas 500 147 821 830 init.proxy.connection 0;
#X obj 10 34 r \$1.receive;
#X obj 37 185 s \$3.peer.port;
#X obj 371 24 r \$1.receive;
#X obj 9 750 s \$1.send;
#X obj 49 561 f;
#X obj 49 582 pack f f;
#X obj 452 660 random 28232;
#X obj 452 680 + 32768;
#X obj 452 705 s \$3.bind.port;
#X obj 49 613 list append;
#X obj 112 592 r \$3.bind.port;
#X obj 371 115 b;
#X obj 9 668 list append;
#X msg 9 690 /\$1/tpf/requestpeerport/\$2;
#N canvas 750 259 301 279 random.seed 0;
#X obj 35 24 loadbang;
#X obj 34 96 realtime;
#X obj 35 66 t b b b;
#X obj 121 128 until;
#X obj 121 148 234.235;
#X obj 121 168 pow 9.2348;
#X obj 34 116 * 1239.29;
#X obj 34 136 int;
#X obj 34 156 mod 9877;
#X obj 34 197 outlet;
#X msg 121 105 143726;
#X msg 34 177 seed \$1;
#X connect 0 0 2 0;
#X connect 1 0 6 0;
#X connect 2 0 1 1;
#X connect 2 1 10 0;
#X connect 2 2 1 0;
#X connect 3 0 4 0;
#X connect 4 0 5 0;
#X connect 6 0 7 0;
#X connect 7 0 8 0;
#X connect 8 0 11 0;
#X connect 10 0 3 0;
#X connect 11 0 9 0;
#X restore 477 636 pd random.seed;
#X obj 24 407 r \$3.peer.ready;
#X obj 9 433 f;
#X obj 9 455 sel 1;
#X msg 111 455 1;
#X obj 111 474 s \$3.aoo.link.status;
#X obj 396 148 r \$3.aoo.link.status;
#X obj 398 196 r \$3.peer.ready;
#X obj 371 148 f;
#X obj 371 171 sel 0 4;
#X obj 371 196 f;
#X obj 371 218 sel 1;
#X obj 371 261 s \$3.aoo.link.status;
#X msg 371 240 2;
#X obj 295 323 r \$3.tx.switch.s;
#X obj 320 346 r \$3.aoo.link.status;
#X obj 322 394 r \$3.peer.ready;
#X obj 295 346 f;
#X obj 295 394 f;
#X obj 295 416 sel 1;
#X obj 295 369 sel 2;
#X obj 10 132 t b a;
#X obj 35 213 r \$3.aoo.link.status;
#X obj 37 261 r \$3.peer.ready;
#X obj 10 213 f;
#X obj 10 261 f;
#X obj 10 283 sel 1;
#X obj 10 236 sel 1;
#X obj 10 347 s \$3.aoo.link.status;
#X msg 10 325 3;
#X msg 295 484 3;
#X obj 295 516 s \$3.aoo.link.status;
#X obj 295 463 del 0;
#X obj 9 477 t b b b;
#X obj 49 516 t b b;
#X obj 111 433 del 0;
#X obj 9 380 r \$3.initiate.stun;
#X obj 10 304 t b b;
#X obj 144 331 s \$3.to.jacktrip;
#X obj 295 437 t b b b;
#X msg 144 308 disabletoken;
#X obj 144 244 t b b;
#X text 611 38 0 = reset;
#X text 612 116 4 = aborted;
#X text 611 58 1 = waiting for peer (stun);
#X text 611 78 2 = waiting for user (stun);
#X text 613 99 3 = connected (stun);
#X text 612 137 5 = waiting for peer (server);
#X text 613 156 6 = waiting for user (server);
#X text 613 177 7 = connected (server);
#X obj 427 573 s \$3.set.random.bind.port;
#X obj 452 614 r \$3.set.random.bind.port;
#X obj 64 539 r \$3.peer.id;
#X obj 94 559 r \$1.id;
#X obj 214 589 r \$1.intercom;
#X obj 214 612 route local_address;
#X obj 49 636 list append;
#X obj 127 185 s \$3.peer.local_ip;
#N canvas 491 144 585 507 destination_host 0;
#X obj 86 201 r \$3.peer.ip;
#X obj 59 398 s \$3.peer.host;
#X obj 26 14 inlet;
#X text 204 9 reasoning;
#X text 204 23 =========;
#X text 202 42 For a peer-2-peer connection \, we usually connect to
the peer IP as seen by the server. However \, when we detect that peer
has the same IP as we have from the server's perspective \, we assume
peer and local are in the same local network. Thus we do not connect
to the IP as seen by the server \, but to the IP that the peer detects
from [tcpclient] \, thus allowing peer-2-peer connections within local
area networks.;
#X obj 26 136 sel -1;
#X obj 59 157 text get \$1.clients;
#X obj 41 61 r \$1.id;
#X obj 26 88 f;
#X obj 26 116 text search \$1.clients 0;
#X msg 59 180 symbol \$4;
#X obj 59 225 sel _;
#X obj 215 273 b;
#X obj 92 323 r \$3.peer.local_ip;
#X obj 248 329 r \$3.peer.ip;
#X obj 59 351 symbol;
#X obj 215 355 symbol;
#X connect 0 0 12 1;
#X connect 2 0 9 0;
#X connect 6 1 7 0;
#X connect 7 0 11 0;
#X connect 8 0 9 1;
#X connect 9 0 10 0;
#X connect 10 0 6 0;
#X connect 11 0 12 0;
#X connect 12 0 16 0;
#X connect 12 1 13 0;
#X connect 13 0 17 0;
#X connect 14 0 16 1;
#X connect 15 0 17 1;
#X connect 16 0 1 0;
#X connect 17 0 1 0;
#X restore 172 278 pd destination_host;
#X msg 214 635 symbol \$1.\$2.\$3.\$4;
#X msg 49 713 /\$1/tpf/setpeerport/\$2 \$3 \$4;
#X obj 37 157 unpack f s;
#X obj 371 48 route /*;
#X obj 371 69 route /tpf/requestpeerport;
#X obj 371 91 route /__;
#X obj 10 58 route /*;
#X obj 10 78 route /tpf/setpeerport;
#X obj 10 112 route /__;
#X connect 0 0 79 0;
#X connect 2 0 76 0;
#X connect 4 0 5 0;
#X connect 5 0 9 0;
#X connect 6 0 7 0;
#X connect 7 0 8 0;
#X connect 9 0 70 0;
#X connect 10 0 9 1;
#X connect 11 0 22 0;
#X connect 12 0 13 0;
#X connect 13 0 3 0;
#X connect 14 0 6 0;
#X connect 15 0 16 1;
#X connect 16 0 17 0;
#X connect 17 0 47 0;
#X connect 18 0 19 0;
#X connect 20 0 22 1;
#X connect 21 0 24 1;
#X connect 22 0 23 0;
#X connect 23 0 24 0;
#X connect 23 1 24 0;
#X connect 24 0 25 0;
#X connect 25 0 27 0;
#X connect 27 0 26 0;
#X connect 28 0 31 0;
#X connect 29 0 31 1;
#X connect 30 0 32 1;
#X connect 31 0 34 0;
#X connect 32 0 33 0;
#X connect 33 0 53 0;
#X connect 34 0 32 0;
#X connect 35 0 38 0;
#X connect 35 1 75 0;
#X connect 36 0 38 1;
#X connect 37 0 39 1;
#X connect 38 0 41 0;
#X connect 39 0 40 0;
#X connect 40 0 51 0;
#X connect 41 0 39 0;
#X connect 43 0 42 0;
#X connect 44 0 45 0;
#X connect 46 0 44 0;
#X connect 47 0 12 0;
#X connect 47 1 48 0;
#X connect 47 2 49 0;
#X connect 48 0 4 0;
#X connect 48 1 64 0;
#X connect 49 0 18 0;
#X connect 50 0 16 0;
#X connect 51 0 43 0;
#X connect 51 1 55 0;
#X connect 53 0 46 0;
#X connect 53 1 48 0;
#X connect 53 2 55 0;
#X connect 54 0 52 0;
#X connect 55 0 54 0;
#X connect 55 1 72 0;
#X connect 65 0 6 0;
#X connect 66 0 4 1;
#X connect 67 0 5 1;
#X connect 68 0 69 0;
#X connect 69 0 73 0;
#X connect 70 0 12 1;
#X connect 70 0 74 0;
#X connect 73 0 70 1;
#X connect 74 0 3 0;
#X connect 75 0 1 0;
#X connect 75 1 71 0;
#X connect 76 0 77 0;
#X connect 77 0 78 0;
#X connect 78 0 11 0;
#X connect 79 0 80 0;
#X connect 80 0 81 0;
#X connect 81 0 35 0;
#X restore 13 65 pd init.proxy.connection;
#X connect 3 0 4 0;
#X connect 4 0 5 0;
#X connect 6 0 4 0;
